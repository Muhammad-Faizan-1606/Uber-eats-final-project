<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Uber Eats Complaint Assistant</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
    <header class="ue-header">
        <div class="ue-header-left">
            <div class="ue-logo">Uber<span>Eats</span> Complaints</div>
            <nav class="ue-nav">
                <a href="#">Home</a>
                <a href="#">Orders</a>
                <a href="#">Help</a>
            </nav>
        </div>
        <div class="ue-header-right">
            <div class="ue-location">
                <span class="ue-location-label">Delivering to</span>
                <span class="ue-location-value">Your saved address</span>
            </div>
            <button class="ue-btn-outline">Sign in</button>
        </div>
    </header>

    <main class="ue-main">
        {% block content %}{% endblock %}
    </main>

    <!-- Agent widget -->
    <div class="agent-widget" id="agent-widget">
        <div class="agent-header">
            <span>Order Complaint Assistant</span>
            <button class="agent-close" id="agent-close-btn">&times;</button>
        </div>
        <div class="agent-body" id="agent-messages">
            <div class="agent-message agent-message-bot">
                Hi! Iâ€™m your complaint assistant. Tell me what went wrong with your order, and Iâ€™ll classify it and guide next steps.
            </div>
        </div>
        <form class="agent-input-row" id="agent-form">
            <input
                type="text"
                id="agent-input"
                placeholder="Describe your issueâ€¦ e.g. 'My order was 45 minutes late and items were missing.'"
                autocomplete="off"
            />
            <button type="submit" class="ue-btn-primary">Send</button>
        </form>
    </div>

    <button class="agent-fab" id="agent-fab">
        ðŸ’¬
    </button>

    <script>
        // Simple front-end agent chat logic
        const agentFab = document.getElementById("agent-fab");
        const agentWidget = document.getElementById("agent-widget");
        const agentClose = document.getElementById("agent-close-btn");
        const agentForm = document.getElementById("agent-form");
        const agentInput = document.getElementById("agent-input");
        const agentMessages = document.getElementById("agent-messages");

        function appendMessage(text, from = "user") {
            const div = document.createElement("div");
            div.classList.add("agent-message");
            if (from === "bot") {
                div.classList.add("agent-message-bot");
            } else {
                div.classList.add("agent-message-user");
            }
            div.innerText = text;
            agentMessages.appendChild(div);
            agentMessages.scrollTop = agentMessages.scrollHeight;
        }

        agentFab.addEventListener("click", () => {
            agentWidget.classList.add("agent-open");
            agentFab.classList.add("agent-hidden");
            agentInput.focus();
        });

        agentClose.addEventListener("click", () => {
            agentWidget.classList.remove("agent-open");
            agentFab.classList.remove("agent-hidden");
        });

        agentForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const text = agentInput.value.trim();
            if (!text) return;

            appendMessage(text, "user");
            agentInput.value = "";
            agentInput.focus();

            // Call your Flask agent API
            try {
                const res = await fetch("/api/agent", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ message: text })
                });

                if (!res.ok) {
                    appendMessage("Sorry, something went wrong talking to the server.", "bot");
                    return;
                }

                const data = await res.json();
                if (data.reply) {
                    appendMessage(data.reply, "bot");
                } else {
                    appendMessage("I couldn't understand the response. Please try again.", "bot");
                }
            } catch (err) {
                appendMessage("Network error. Please try again.", "bot");
            }
        });
    </script>
</body>
</html>
